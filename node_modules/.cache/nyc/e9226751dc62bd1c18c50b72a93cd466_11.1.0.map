{"version":3,"sources":["fetch.js"],"names":["fetchJson","url","options","requestHeaders","headers","Headers","Accept","body","FormData","set","user","authenticated","token","fetch","mode","cache","then","response","text","status","statusText","json","JSON","parse","id","_id","e","Promise","reject","message","queryParameters","Object","keys","data","map","key","encodeURIComponent","join"],"mappings":";;;;;;;;;;;AAAA;;AACA;;;;;;AAEO,IACHA,gCAAY,SAAZA,SAAY,CAACC,GAAD,EAAuB;AAAA,QAAjBC,OAAiB,uEAAP,EAAO;;AACnC,QAAMC,iBAAiBD,QAAQE,OAAR,IAAmB,IAAIC,OAAJ,CAAY;AAClDC,gBAAQ;AAD0C,KAAZ,CAA1C;AAGA,QAAI,EAAEJ,WAAWA,QAAQK,IAAnB,IAA2BL,QAAQK,IAAR,YAAwBC,QAArD,CAAJ,EAAoE;AAChEL,uBAAeM,GAAf,CAAmB,cAAnB,EAAmC,kBAAnC;AACH;AACD,QAAIP,QAAQQ,IAAR,IAAgBR,QAAQQ,IAAR,CAAaC,aAA7B,IAA8CT,QAAQQ,IAAR,CAAaE,KAA/D,EAAsE;AAClET,uBAAeM,GAAf,CAAmB,eAAnB,EAAoCP,QAAQQ,IAAR,CAAaE,KAAjD;AACH;AACD;AACA;AACA;AACA;AACA,WAAOC,MAAMZ,GAAN,6BAAgBC,OAAhB,IAA0BY,MAAK,MAA/B,EAAsCC,OAAO,SAA7C,EAAuDX,SAASD,cAAhE,KACFa,IADE,CACG;AAAA,eAAYC,SAASC,IAAT,GAAgBF,IAAhB,CAAqB;AAAA,mBAAS;AAC5CG,wBAAQF,SAASE,MAD2B;AAE5CC,4BAAYH,SAASG,UAFuB;AAG5ChB,yBAASa,SAASb,OAH0B;AAI5CG,sBAAMW;AAJsC,aAAT;AAAA,SAArB,CAAZ;AAAA,KADH,EAOFF,IAPE,CAOG,gBAA2C;AAAA,YAAxCG,MAAwC,QAAxCA,MAAwC;AAAA,YAAhCC,UAAgC,QAAhCA,UAAgC;AAAA,YAApBhB,OAAoB,QAApBA,OAAoB;AAAA,YAAXG,IAAW,QAAXA,IAAW;;AAC7C,YAAIc,aAAJ;AACA,YAAI;AACAA,mBAAOC,KAAKC,KAAL,CAAWhB,IAAX,CAAP;AACAc,iBAAKG,EAAL,GAAUH,KAAKI,GAAf;AACA,mBAAOJ,KAAKI,GAAZ;AACH,SAJD,CAIE,OAAOC,CAAP,EAAU;AACR;AACH;AACD,YAAIP,SAAS,GAAT,IAAgBA,UAAU,GAA9B,EAAmC;AAC/B,mBAAOQ,QAAQC,MAAR,CAAe,wBAAeP,QAAQA,KAAKQ,OAAd,IAA0BT,UAAxC,EAAoDD,MAApD,CAAf,CAAP;AACH;AACD,eAAO,EAAEA,cAAF,EAAUf,gBAAV,EAAmBG,UAAnB,EAAyBc,UAAzB,EAAP;AACH,KApBE,CAAP;AAqBH,CApCM;;AAsCA,IAAMS,4CAAkB,SAAlBA,eAAkB;AAAA,WAAQC,OAAOC,IAAP,CAAYC,IAAZ,EAClCC,GADkC,CAC9B;AAAA,eAAO,CAACC,GAAD,EAAMF,KAAKE,GAAL,CAAN,EAAiBD,GAAjB,CAAqBE,kBAArB,EAAyCC,IAAzC,CAA8C,GAA9C,CAAP;AAAA,KAD8B,EAElCA,IAFkC,CAE7B,GAF6B,CAAR;AAAA,CAAxB","file":"fetch.js","sourceRoot":"/home/chen/LD300-FX/src/lib/util","sourcesContent":["import 'babel-polyfill'\nimport HttpError from './HttpError';\n\nexport const\n    fetchJson = (url, options = {}) => {\n    const requestHeaders = options.headers || new Headers({\n        Accept: 'application/json',\n    });\n    if (!(options && options.body && options.body instanceof FormData)) {\n        requestHeaders.set('Content-Type', 'application/json');\n    }\n    if (options.user && options.user.authenticated && options.user.token) {\n        requestHeaders.set('Authorization', options.user.token);\n    }\n    // requestHeaders.set('Origin', 'http://localhost:8080');\n    //     requestHeaders.set('Access-Control-Request-Method','GET,PUT, DELETE, POST')\n    //     requestHeaders.set('Access-Control-Request-Headers','Origin,Content-Type,Authorization')\n    //     requestHeaders.set('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');\n    return fetch(url, { ...options,  mode:'cors',cache: 'default',headers: requestHeaders })\n        .then(response => response.text().then(text => ({\n            status: response.status,\n            statusText: response.statusText,\n            headers: response.headers,\n            body: text,\n        })))\n        .then(({ status, statusText, headers, body }) => {\n            let json;\n            try {\n                json = JSON.parse(body);\n                json.id = json._id;\n                delete json._id;\n            } catch (e) {\n                // not json, no big deal\n            }\n            if (status < 200 || status >= 300) {\n                return Promise.reject(new HttpError((json && json.message) || statusText, status));\n            }\n            return { status, headers, body, json };\n        });\n};\n\nexport const queryParameters = data => Object.keys(data)\n    .map(key => [key, data[key]].map(encodeURIComponent).join('='))\n    .join('&');\n"]}